{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://genaptitude.local/schemas/v1/sandbox/generation-context.schema.json",
  "title": "Generation Context",
  "description": "Données contextuelles injectées lors de l'exécution d'une recette.",
  "x_schemaVersion": "1.0.0",
  "x_label": {
    "fr": "Contexte de Génération",
    "en": "Generation Context"
  },
  "x_description": {
    "fr": "Structure de données fusionnant l'input utilisateur et les variables système pour les templates.",
    "en": "Data structure merging user input and system variables for templates."
  },
  "type": "object",
  "allOf": [
    {
      "$ref": "../common/types/base.schema.json",
      "description": "Hérite des champs systèmes standards."
    }
  ],
  "properties": {
    "targetInstanceId": {
      "$ref": "../common/types/primitive-types.schema.json#/$defs/uuid",
      "description": "ID de l'objet métier (ex: la dApp) qui sert de source."
    },
    "recipeId": {
      "$ref": "../common/types/primitive-types.schema.json#/$defs/slug",
      "description": "ID de la recette utilisée."
    },
    "variables": {
      "type": "object",
      "description": "Variables calculées disponibles pour les templates.",
      "additionalProperties": true
    },
    "options": {
      "type": "object",
      "properties": {
        "force": { "type": "boolean", "default": false },
        "dryRun": { "type": "boolean", "default": false }
      }
    },
    "system": {
      "type": "object",
      "description": "Méta-informations sur l'environnement d'exécution.",
      "properties": {
        "engineVersion": {
          "$ref": "../common/types/primitive-types.schema.json#/$defs/nonEmptyString"
        },
        "environment": { "type": "string", "enum": ["dev", "prod", "test"] },
        "generatedBy": {
          "$ref": "../common/types/primitive-types.schema.json#/$defs/nonEmptyString"
        }
      },
      "required": ["engineVersion", "generatedBy"]
    }
  },
  "required": ["targetInstanceId", "recipeId", "variables", "system"],
  "additionalProperties": false,
  "unevaluatedProperties": false
}
